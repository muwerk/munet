<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>munet Network Library for muwerk Scheduler on ESP Hardware: ustd::Net Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">munet Network Library for muwerk Scheduler on ESP Hardware
   </div>
   <div id="projectbrief">A muwerk network library supporting WiFi, NTP, OTA and MQTT for ESP8266 and ESP32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceustd.html">ustd</a></li><li class="navelem"><a class="el" href="classustd_1_1Net.html">Net</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classustd_1_1Net-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ustd::Net Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>munet, the muwerk network class for WiFi and NTP  
 <a href="classustd_1_1Net.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="net_8h_source.html">net.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8e11f58403f0d2ff4918352209a47349"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classustd_1_1Net.html#a8e11f58403f0d2ff4918352209a47349">Net</a> (uint8_t signalLed=0xff, bool signalLogic=false)</td></tr>
<tr class="separator:a8e11f58403f0d2ff4918352209a47349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d075f7d15c5e3ff3355959c840cd408"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classustd_1_1Net.html#a0d075f7d15c5e3ff3355959c840cd408">begin</a> (Scheduler *pScheduler, Netmode opmode=AP, bool restartOnMultipleFailures=true)</td></tr>
<tr class="separator:a0d075f7d15c5e3ff3355959c840cd408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81a9d3aa22ddec85d46effa088d0e670"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classustd_1_1Net.html#a81a9d3aa22ddec85d46effa088d0e670">begin</a> (Scheduler *pScheduler, String SSID, String password=&quot;&quot;, String hostname=&quot;muwerk-${macls}&quot;, Netmode opmode=AP, bool restartOnMultipleFailures=true)</td></tr>
<tr class="separator:a81a9d3aa22ddec85d46effa088d0e670"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>munet, the muwerk network class for WiFi and NTP </p>
<p>The library header-only and relies on the libraries ustd, muwerk, Arduino_JSON and PubSubClient.</p>
<p>Make sure to provide the <a href="https://github.com/muwerk/ustd/blob/master/README.md">required platform define</a> before including ustd headers.</p>
<p>See <a href="https://github.com/muwerk/munet/blob/master/README.md">README.md</a> for a detailed description of all network configuration options.</p>
<p>Alternatively, operating mode and credentials can be given in source code during <a class="el" href="classustd_1_1Net.html#a0d075f7d15c5e3ff3355959c840cd408">Net.begin()</a>. (s.b.)</p>
<h2>Sample network connection</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define __ESP__ 1   </span><span class="comment">// Platform defines required, see doc, mainpage.</span></div>
<div class="line"><span class="preprocessor">#include &quot;scheduler.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;net.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ota.h&quot;</span>  <span class="comment">// optional for over-the-air software updates</span></div>
<div class="line"><span class="preprocessor">#include &quot;mqtt.h&quot;</span> <span class="comment">// optional for connection to external MQTT server</span></div>
<div class="line"> </div>
<div class="line">ustd::Scheduler sched;</div>
<div class="line"><a class="code" href="classustd_1_1Net.html">ustd::Net</a> net(LED_BUILTIN);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classustd_1_1Ota.html">ustd::Ota</a> ota();  <span class="comment">// optional</span></div>
<div class="line"><a class="code" href="classustd_1_1Mqtt.html">ustd::Mqtt</a> mqtt();<span class="comment">// optional</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> appLoop();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    pinMode(LED_BUILTIN, OUTPUT);</div>
<div class="line">    net.begin(&amp;sched);  <span class="comment">// connect to WLAN and sync NTP time,</span></div>
<div class="line">                        <span class="comment">// credentials read from LittleFS, (net.json)</span></div>
<div class="line">    ota.begin(&amp;sched);  <span class="comment">// optional ota update</span></div>
<div class="line">    mqtt.begin(&amp;sched); <span class="comment">// optional connection to external MQTT server</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> tID = sched.add(appLoop, <span class="stringliteral">&quot;main&quot;</span>);  <span class="comment">// create task for your app code</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> appLoop() {</div>
<div class="line">    <span class="comment">// your code goes here.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Never add code to this loop, use appLoop() instead.</span></div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    sched.loop();</div>
<div class="line">}</div>
<div class="ttc" id="aclassustd_1_1Mqtt_html"><div class="ttname"><a href="classustd_1_1Mqtt.html">ustd::Mqtt</a></div><div class="ttdoc">munet MQTT Gateway Class</div><div class="ttdef"><b>Definition:</b> mqtt.h:79</div></div>
<div class="ttc" id="aclassustd_1_1Net_html"><div class="ttname"><a href="classustd_1_1Net.html">ustd::Net</a></div><div class="ttdoc">munet, the muwerk network class for WiFi and NTP</div><div class="ttdef"><b>Definition:</b> net.h:72</div></div>
<div class="ttc" id="aclassustd_1_1Ota_html"><div class="ttname"><a href="classustd_1_1Ota.html">ustd::Ota</a></div><div class="ttdoc">munet OTA Class</div><div class="ttdef"><b>Definition:</b> ota.h:57</div></div>
</div><!-- fragment --> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8e11f58403f0d2ff4918352209a47349"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e11f58403f0d2ff4918352209a47349">&#9670;&nbsp;</a></span>Net()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ustd::Net::Net </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>signalLed</em> = <code>0xff</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>signalLogic</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Instantiate a network object for WiFi and NTP connectivity.</p>
<p>The <a class="el" href="classustd_1_1Net.html" title="munet, the muwerk network class for WiFi and NTP">Net</a> object publishes messages using muwerk's pub/sub intertask communication (which does not rely on MQTT servers), other muwerk tasks can subscribe to the following topics:</p>
<ul>
<li><code>net/network</code>: for information about WiFi connection state changes. Status can be actively requested by publishing <code>net/network/get</code></li>
<li><code>net/rssi</code>: for information about WiFi signal strength</li>
<li><code>net/connections</code>: for changes in the number of connected clients when operating as access point</li>
<li><code>net/networks</code>: for a list of WiFi networks nearby. The list can be requested by publishing <code>net/networks/get</code></li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">signalLed</td><td>(optional), Pin that will be set to LOW (led on) during network connection attempts. Once connected, led is switched off and can be used for other functions. Led on signals that the ESP is trying to connect to a network. </td></tr>
    <tr><td class="paramname">signalLogic</td><td>(optional, default <code>false</code>) If <code>true</code> the signal logic for the led is inverted.</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0d075f7d15c5e3ff3355959c840cd408"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d075f7d15c5e3ff3355959c840cd408">&#9670;&nbsp;</a></span>begin() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ustd::Net::begin </td>
          <td>(</td>
          <td class="paramtype">Scheduler *&#160;</td>
          <td class="paramname"><em>pScheduler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Netmode&#160;</td>
          <td class="paramname"><em>opmode</em> = <code>AP</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>restartOnMultipleFailures</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Starts the network based on the stored configuration.</p>
<p>This method starts the network using the information stored into the configuration file /net.json. Depending on how the network mode is configured, it may be idle (since disabled), running as an access point or as a station or both.</p>
<p>Other muwerk task can subscribe to topic '<code>net/network</code>' to receive information about network connection states.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pScheduler</td><td>Pointer to the muwerk scheduler. </td></tr>
    <tr><td class="paramname">opmode</td><td>(optional, default AP) Default operation mode if none is configured </td></tr>
    <tr><td class="paramname">restartOnMultipleFailures</td><td>(optional, default <code>true</code>) Default restart on continued failure if none is configured.</td></tr>
  </table>
  </dd>
</dl>
<p>See <a href="https://github.com/muwerk/munet/blob/master/README.md">README.md</a> for a detailed description of all network configuration options.</p>

</div>
</div>
<a id="a81a9d3aa22ddec85d46effa088d0e670"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81a9d3aa22ddec85d46effa088d0e670">&#9670;&nbsp;</a></span>begin() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ustd::Net::begin </td>
          <td>(</td>
          <td class="paramtype">Scheduler *&#160;</td>
          <td class="paramname"><em>pScheduler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"><em>SSID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"><em>password</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"><em>hostname</em> = <code>&quot;muwerk-${macls}&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Netmode&#160;</td>
          <td class="paramname"><em>opmode</em> = <code>AP</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>restartOnMultipleFailures</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Starts the network based on the supplied configuration.</p>
<p>This function starts the network using the supplied information and is intended for projects with hardcoded network configuration. This method allows only to configure the network running as an access point or as a station.</p>
<p>Other muwerk task can subscribe to topic '<code>net/network</code>' to receive information about network connection states.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pScheduler</td><td>Pointer to the muwerk scheduler. </td></tr>
    <tr><td class="paramname">SSID</td><td>The SSID for the WiFi connection or access point. This can contin placeholder (see below). </td></tr>
    <tr><td class="paramname">password</td><td>(optional, default unused) The password for the WiFi connection or access point </td></tr>
    <tr><td class="paramname">hostname</td><td>(optional, default <code>"muwerk-${macls}"</code>) The hostname of the system. This can contain placeholder (see below). </td></tr>
    <tr><td class="paramname">opmode</td><td>(optional, default AP) The operating mode of the network. Can be AP or STATION </td></tr>
    <tr><td class="paramname">restartOnMultipleFailures</td><td>(optional, default <code>true</code>) restarts the device on continued failure.</td></tr>
  </table>
  </dd>
</dl>
<p>In STATION mode the network connects to an available WiFi network using the supplied credentials. After connecting, the system requests a network configuration via DHCP. After receiving the configuration, the IP address, netmask and gateway are set. If the DHCP server sends information about a valid NTP server, the time is synchronized using the information from that server.</p>
<p>Some of the configuration options support the use of placeholders in order to allow values that are specific to a certain device without the need to create separate configuration files. Placeholders are written in the form of <code>${PLACEHOLDER}</code>.</p>
<p>The following placeholders are currently available:</p><ul>
<li><code>mac</code>: full mac address</li>
<li><code>macls</code>: last 4 digits of mac address</li>
<li><code>macfs</code>: first 4 digits of mac address</li>
</ul>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="net_8h_source.html">net.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
