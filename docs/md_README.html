<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Munet ESP network library for muwerk scheduler: munet</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Munet ESP network library for muwerk scheduler
   </div>
   <div id="projectbrief">A muwerk network library for WLAN, NTP, OTA and MQTT support for ESP8266 and ESP32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">munet </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/muwerk/munet"><img src="https://travis-ci.org/muwerk/munet.svg?branch=master" alt="ESP12e build" class="inline"/>
</a></p>
<p>The munet libraries use the <a href="https://github.com/muwerk/muwerk">muwerk scheduler</a> to provide a comprehensive set of network functionality: WLAN connection, NTP time sync, OTA software update and MQTT communication for ESP8266 and ESP32 chips with a minimum of code:</p>
<div class="fragment"><div class="line"> {c++}</div><div class="line">#define __ESP__   // Platform define, add #define __ESP32__ for ESP32 (see dependencies)</div><div class="line">#include &quot;scheduler.h&quot;</div><div class="line">#include &quot;net.h&quot;</div><div class="line">#include &quot;mqtt.h&quot;</div><div class="line">#include &quot;ota.h&quot;</div><div class="line"></div><div class="line">ustd::Scheduler sched;</div><div class="line">ustd::Net net(LED_BUILTIN);</div><div class="line">ustd::Mqtt mqtt;</div><div class="line">ustd::Ota ota;</div><div class="line"></div><div class="line">void appLoop();</div><div class="line"></div><div class="line">void setup() {</div><div class="line">    net.begin(&amp;sched);  // connect to WLAN and sync NTP time, credentials read from SPIFFS, (s.b.)</div><div class="line">    mqtt.begin(&amp;sched); // connect to MQTT server</div><div class="line">    ota.begin(&amp;sched);  // enable OTA updates</div><div class="line">    </div><div class="line">    int tID = sched.add(appLoop, &quot;main&quot;);  // create task for your app code</div><div class="line">}</div><div class="line"></div><div class="line">void appLoop() {</div><div class="line">    // your code goes here.</div><div class="line">}</div><div class="line"></div><div class="line">// Never add code to this loop, use appLoop() instead.</div><div class="line">void loop() {</div><div class="line">    sched.loop();</div><div class="line">}</div></div><!-- fragment --><p>The library provides:</p>
<ul>
<li>Network WLAN access, using credentials read from SPIFFS file system (s.b.), automatic connection to a WLAN is established. The library handles re-connect and error recovery gracefully.</li>
<li>Over-the-air (OTA) update is supported with one line of code [optional]</li>
<li>Time synchronization with NTP servers, including daylight saving handling [optional]</li>
<li>Connection to an MQTT server (via PubSubClient) [optional] This transparently connects the pub/sub inter-task communication that is provided by the muwerk scheduler with extern MQTT publishers and subscribers. Messages between muwerk tasks are published to the external MQTT server, and muwerk tasks can transparently subscribe to both other tasks on the same ESP and external topics via the MQTT interface.</li>
</ul>
<h2>Dependencies</h2>
<p>Munet relies only on:</p>
<ul>
<li><a href="https://github.com/muwerk/ustd">ustd</a>. Check documentation for required platform defines.</li>
<li><a href="https://github.com/muwerk/ustd">muwerk</a></li>
<li><a href="https://github.com/knolleary/pubsubclient">PubSubClient</a></li>
<li><a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a></li>
</ul>
<h2>Configuration</h2>
<p>The network configuration is stored in a <code>json</code> formatted file <code>net.json</code> in the SPIFFS file system of the ESP chip. Create a copy in your local file system of your project at <code>data/net.json</code>.</p>
<h3>Sample <code>net.json</code></h3>
<div class="fragment"><div class="line">{</div><div class="line">&quot;SSID&quot;:&quot;my-network-SSID&quot;,</div><div class="line">&quot;password&quot;:&quot;myS3cr3t&quot;,</div><div class="line">&quot;hostname&quot;:&quot;myhost&quot;,</div><div class="line">&quot;services&quot;: [</div><div class="line">   {&quot;timeserver&quot;: &quot;time.nist.gov&quot;},</div><div class="line">   {&quot;dstrules&quot;: &quot;CET-1CEST,M3.5.0,M10.5.0/3&quot;},</div><div class="line">   {&quot;mqttserver&quot;: &quot;my.mqtt.server&quot;}</div><div class="line">]</div><div class="line">}</div></div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadNone">Usage   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SSID  </td><td class="markdownTableBodyNone">Network name of the wireless network the ESP will join   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">password  </td><td class="markdownTableBodyNone">Wireless network password   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">hostname  </td><td class="markdownTableBodyNone">Hostname the ESP will try to register at the DHCP server   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">timeserver  </td><td class="markdownTableBodyNone">optional address of an NTP time server, if given, ESP time will be synchronized   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dstrules  </td><td class="markdownTableBodyNone">optional timezone and daylight saving rules in <a href="https://mm.icann.org/pipermail/tz/2016-April/023570.html">unix format</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mqttserver  </td><td class="markdownTableBodyNone">optional address of MQTT server ESP connects to   </td></tr>
</table>
<p>Using platformio, <code>data/net.conf</code> is saved to the ESP chip using:</p>
<div class="fragment"><div class="line">pio run -t buildfs</div><div class="line">pio run -t updatefs</div></div><!-- fragment --><h2>Documentation</h2>
<ul>
<li><a href="https://muwerk.github.io/munet/docs/index.html">ustd::munet documentation.</a> [WIP]</li>
<li><a href="https://muwerk.github.io/muwerk/docs/index.html">ustd::muwerk documentation.</a></li>
<li><code>ustd</code> required platform defines.</li>
<li><a href="https://muwerk.github.io/ustd/docs/index.html">ustd::ustd documentation.</a></li>
</ul>
<h2>ESP32 notes</h2>
<ul>
<li>In order to build MQTT for ESP32, PubSubClient v2.7 or newer is needed.</li>
<li>SPIFFS filesystem: Optionally use this <a href="https://github.com/me-no-dev/arduino-esp32fs-plugin">Arduino plugin</a> to upload the SPIFFS filesystem to ESP32.</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://github.com/muwerk/ustd">ustd</a> microWerk standard library</li>
<li><a href="https://github.com/muwerk/muwerk">muWerk</a> microWerk scheduler</li>
<li><a href="https://github.com/muwerk/mupplets">mupplets</a> sensor and io functionality blocks</li>
<li><a href="https://github.com/knolleary/pubsubclient">PubSubClient</a> the excellent MQTT library used by munet.</li>
<li><a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a> a low-resource JSON library for Arduino</li>
<li>Time zone rules: <a href="https://mm.icann.org/pipermail/tz/2016-April/023570.html">https://mm.icann.org/pipermail/tz/2016-April/023570.html</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
